function PegasusParade(a)local a=a or{top=0,bottom=128,left=0,right=128}local b={x=0,y=0}local c={}local d={}local e={8,9,10,11,12,14}local f={x=function(g)return g+b.x end,y=function(h)return h+b.y end}local i=0;function draw_big_peglette(j,k,l,m)j=j or 0;k=k or 0;l=l or false;m=m or false;local n=208%16*8;local o=flr(208/16)*8+6;sspr(n,o,24,22,j,k,24,22,l,m)end;function draw_small_peglette(g,h,p,q)g=g or 0;h=h or 0;p=p or false;q=q or false;local r=118%16*8;local s=flr(118/16)*8;sspr(r,s,12,9,g,h,12,9,p,q)end;function create_particle(g,h,t,u,v,w)add(d,{x=g,y=h,dx=t,dy=u,life=v,color=w})end;function update_particles()for x=#d,1,-1 do local y=d[x]y.x=y.x+y.dx;y.y=y.y+y.dy;y.life=y.life-1;if y.life<=0 then deli(d,x)end end end;function draw_particles()for y in all(d)do pset(y.x,y.y,y.color)end end;function ease_out_quad(z)return 1-(1-z)*(1-z)end;function create_pegasus(A)local B={big={quantity=2,offset_min=a.left-80,offset_max=a.left-40,speed_min=1.5,speed_max=2.5,hop_height_min=8,hop_height_max=16,hop_duration_min=40,hop_duration_max=60,draw_func=draw_big_peglette},small={quantity=flr(rnd(5))+4,offset_min=a.left-60,offset_max=a.left-20,speed_min=2,speed_max=3,hop_height_min=4,hop_height_max=8,hop_duration_min=30,hop_duration_max=50,draw_func=draw_small_peglette}}local l=A and B.big or B.small;for x=1,l.quantity do local C=rnd(a.bottom-a.top-40)+a.top+20;add(c,{big=A,x=A and-rnd(120)or rnd(l.offset_max-l.offset_min)+l.offset_min,y=C,base_y=C,speed=rnd(l.speed_max-l.speed_min)+l.speed_min,hop_height=rnd(l.hop_height_max-l.hop_height_min)+l.hop_height_min,hop_duration=flr(rnd(l.hop_duration_max-l.hop_duration_min)+l.hop_duration_min),hop_timer=rnd(l.hop_duration_max),draw=function(self)self.x=self.x+self.speed;self.hop_timer=self.hop_timer+1;if self.hop_timer>=self.hop_duration then self.hop_timer=0 end;local D=self.hop_timer/self.hop_duration;local E=self.hop_height*ease_out_quad(1-abs(2*D-1))self.y=self.base_y-E;local F=self.big and 3 or 2;for x=1,F do local w=e[flr(rnd(#e))+1]create_particle(self.x+rnd(8)-4,self.y+rnd(8)-4,-rnd(0.5)-0.5,rnd(0.2)-0.1,20+rnd(10),w)end;l.draw_func(self.x,self.y,true,false)end})end end;function draw()draw_particles()for x,G in pairs(c)do G.draw(G)end end;function update()i=i+1;if i>1000 then i=0 end;update_particles()end;function trigger()c={}d={}create_pegasus(true)create_pegasus(false)end;return{draw=draw,update=update,trigger=trigger}end