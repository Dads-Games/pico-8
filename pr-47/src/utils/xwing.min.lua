function Laser(a,b)return{x=a,y=b,speed=4,update=function(self)self.x=self.x-self.speed end,draw=function(self)rectfill(self.x,self.y,self.x+2,self.y+1,8)end,is_off_screen=function(self)return self.x<0 end}end;function EngineTrail()local c={}local d={{color=7,percent=0.1},{color=10,percent=0.3},{color=9,percent=0.6},{color=8,percent=0.9}}local e={}local function f(a,b)local g=rnd(0.25)+0.5;return{x=a,y=b,speed=rnd(0.075)+0.25,life=g,starting_life=g}end;function c:update(a,b)for h in all(e)do h.life=h.life-rnd(0.5)h.x=h.x+h.speed;if h.life<=0 then h.x,h.y,h.speed,h.life,h.starting_life=a,b,rnd(0.075)+0.25,rnd(0.25)+0.5,rnd(0.25)+0.5 end end end;function c:draw()for h in all(e)do local i=1-h.life/h.starting_life;local j=8;for k=1,#d do if i<d[k].percent then j=d[k].color;break end end;pset(h.x+rnd(3)*(rnd(1)>0.5 and 1 or-1),h.y+flr(rnd((1-i)*3)-1),j)end end;for k=1,30 do add(e,f(-30,-30))end;return c end;function Xwing(l)local l=l or 100;local m={position={x=-100,y=50}}local n,o=false,nil;local p,q=EngineTrail(),EngineTrail()local r={}local s=12;local t=0.005;local u=0;local function v(w,x)return m.position.x+w,m.position.y+x end;local function y()m.position.x=m.position.x-2;m.position.y=50+sin(m.position.x*t)*s;if o then o=o+1 end;if n and m.position.x<-64 then m.position.x=200;n=false end;p:update(v(30,6))q:update(v(30,10))for z in all(r)do z:update()if z:is_off_screen()then del(r,z)end end;if u%10==0 then add(r,Laser(v(8,0)))end;if u%15==0 then add(r,Laser(v(8,16)))end;if u then u=u+1 end end;local function A()local B,C=124%16*8,flr(124/16)*8;local D,E=v(0,0)sspr(B,C,32,16,D,E)if D>-128 and D<128 then p:draw()q:draw()end;for z in all(r)do z:draw()end end;local function F()if o==nil or o>l then n,o=true,0 end end;return{view=A,controller=y,trigger=F}end